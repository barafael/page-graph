use std::io::copy;
use std::fs::File;
use tempfile::Builder;


#[tokio::main]
async fn main() -> Result<()> {
    let tmp_dir = Builder::new().prefix("example").tempdir()?;
    let target = "https://www.rust-lang.org/logos/rust-logo-512x512.png";
    let response = reqwest::get(target).await?;

    let urls = vec![
        "https://www.traplinked.com/cart/",
"https://www.traplinked.com/checkout/",
"https://www.traplinked.com/my-account-2/",
"https://www.traplinked.com/der-alltag-eines-schaedlingsbekaempfers-nothilfe-im-ratten-haus/",
"https://www.traplinked.com/traut-euch-in-die-digitale-schaedlingsbekaempfung-zu-investieren/",
"https://www.traplinked.com/die-5-gaengigsten-fallen-um-maeuse-und-ratten-zu-bekaempfen/",
"https://www.traplinked.com/6-tipps-fuer-maximalen-fangerfolg-mit-schlagfallen/",
"https://www.traplinked.com/unser-testkoffer/",
"https://www.traplinked.com/downloads/",
"https://www.traplinked.com/seminar-toeten-von-wirbeltieren-gem-%c2%a74-tierschutzgesetz/",
"https://www.traplinked.com/mein-konto/",
"https://www.traplinked.com/die-schaedlingsbekaempfung-ist-eine-so-spannende-und-vielseitige-taetigkeit/",
"https://www.traplinked.com/webinare/",
"https://www.traplinked.com/testkoffer-anleitung/",
"https://www.traplinked.com/7-profi-tricks-fuer-die-arbeit-mit-lockstoffen-und-koedern/",
"https://www.traplinked.com/dokumentation-in-der-schadlingsbekampfung/",
"https://www.traplinked.com/beratung/",
"https://www.traplinked.com/karriere/",
"https://www.traplinked.com/digitale-schaedlingsbekaempfung/",
"https://www.traplinked.com/rodentizide-als-toxische-zeitbomben/",
"https://www.traplinked.com/studienlogin/",
"https://www.traplinked.com/studienregistrierung/",
"https://www.traplinked.com/registration/",
"https://www.traplinked.com/my-account/",
"https://www.traplinked.com/studien/",
"https://www.traplinked.com/feedback/",
"https://www.traplinked.com/systemrelevanz/",
"https://www.traplinked.com/risikominderungsmassnahmen/",
"https://www.traplinked.com/kostenrechner/",
"https://www.traplinked.com/termine/",
"https://www.traplinked.com/permanent-monitoring/",
"https://www.traplinked.com/blog/",
"https://www.traplinked.com/lexikon/",
"https://www.traplinked.com/lexikon-hausmaus/",
"https://www.traplinked.com/jobs-vertrieb/",
"https://www.traplinked.com/anleitung/",
"https://www.traplinked.com/workinprogress/",
"https://www.traplinked.com/faq/",
"https://www.traplinked.com/team/",
"https://www.traplinked.com/datenschutz/",
"https://www.traplinked.com/impressum/",
"https://www.traplinked.com/public_mentions/",
"https://www.traplinked.com/konnektivitaet/",
"https://www.traplinked.com/jobs-software/",
"https://www.traplinked.com/konzept/",
"https://www.traplinked.com/software/",
"https://www.traplinked.com/hardware/",
"https://www.traplinked.com/",
    ];

    let mut dest = {
        let fname = response
            .url()
            .path_segments()
            .and_then(|segments| segments.last())
            .and_then(|name| if name.is_empty() { None } else { Some(name) })
            .unwrap_or("tmp.bin");

        println!("file to download: '{}'", fname);
        let fname = tmp_dir.path().join(fname);
        println!("will be located under: '{:?}'", fname);
        File::create(fname)?
    };
    let content =  response.text().await?;
    copy(&mut content.as_bytes(), &mut dest)?;
    Ok(())
}

